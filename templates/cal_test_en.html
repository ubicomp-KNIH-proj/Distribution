<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html" charset="EUC-KR">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="../static/style.css" type="text/css">
    <title>KNIH_Galaxy user</title>
    <style type="text/css">
        td {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 20px;
            font-family: 굴림;
            border: 2px;
            border-color: #3333FF;
            border-radius: 8px;
        }

        #etc {
            background-color: #bac9cd;
            font-family: Arial, sans-serif;
            padding: 20px 20px;
            font-size: 15px;
            height: 100%;
        }
    </style>

    <script type="text/javascript">
        var today = new Date();
        var date = new Date();

        function julyCalendar() {
            // alert(today.getMonth())
            today = new Date(today.getFullYear(), 6, today.getDate());
            buildCalendar();
        }

        function augustCalendar() {
            today = new Date(today.getFullYear(), 7, today.getDate());
            buildCalendar2();
        }

        function septemCalendar() {
            today = new Date(today.getFullYear(), 8, today.getDate());
            buildCalendar3();
        }

        function buildCalendar() {
            var cal = '{{ cal|tojson }}'
            var cal_l = JSON.parse(cal)
            let reg_y = '{{reg_y}}'
            let reg_m = '{{reg_m}}'
            let reg_d = '{{reg_d}}'
            var doMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            var lastDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            var tbCalendar = document.getElementById("calendar");
            var tbCalendarYM = document.getElementById("tbCalendarYM");
            tbCalendarYM.innerHTML = today.getFullYear() + "년 " + 7 + "월";

            while (tbCalendar.rows.length > 2) {
                tbCalendar.deleteRow(tbCalendar.rows.length - 1);
            }
            var row = null;
            row = tbCalendar.insertRow();
            var cnt = 0;
            for (i = 0; i < doMonth.getDay(); i++) {
                cell = row.insertCell();
                cnt = cnt + 1;
            }
            for (i = 1; i <= 31; i++) {
                cell = row.insertCell();
                // cell.innerHTML = '<button type="button">i</button>';
                cell.innerHTML = i;
                cell.setAttribute('type', 'button');
                cnt = cnt + 1;
                if (cnt % 7 == 1) {
                    cell.innerHTML = "<font color=black>" + i
                }
                if (cnt % 7 == 0) {
                    cell.innerHTML = "<font color=black>" + i
                    row = calendar.insertRow();
                }
                if (reg_m == 7) {
                    sum = Number(reg_d) + Number(cal_l.length)
                    for (k = reg_d; k < sum; k++) {
                        if (today.getFullYear() == date.getFullYear() && i == k) {
                            if (cal_l[i - reg_d] == 0) {
                                // cell.bgColor = "F08080"
                                // cell.bgColor = "DC143C"
                                cell.bgColor = "CD5C5C"
                            } else {
                                cell.bgColor = "228B22"
                            }
                        }
                    }
                }

            }
        }

        function buildCalendar2() {
            var cal = '{{ cal|tojson }}'
            var cal_l = JSON.parse(cal)
            let reg_y = '{{reg_y}}'
            let reg_m = '{{reg_m}}'
            let reg_d = '{{reg_d}}'
            var doMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            var lastDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            var tbCalendar = document.getElementById("calendar");
            var tbCalendarYM = document.getElementById("tbCalendarYM");
            tbCalendarYM.innerHTML = today.getFullYear() + "년 " + 8 + "월";

            while (tbCalendar.rows.length > 2) {
                tbCalendar.deleteRow(tbCalendar.rows.length - 1);
            }
            var row = null;
            row = tbCalendar.insertRow();
            var cnt = 0;
            for (i = 0; i < doMonth.getDay(); i++) {
                cell = row.insertCell();
                cnt = cnt + 1;
            }
            for (i = 1; i <= 31; i++) {
                cell = row.insertCell();
                cell.innerHTML = i;
                cnt = cnt + 1;
                if (cnt % 7 == 1) {/*일요일 계산*/
                    cell.innerHTML = "<font color=black>" + i
                }
                if (cnt % 7 == 0) {
                    cell.innerHTML = "<font color=black>" + i
                    row = calendar.insertRow();
                }
                if (reg_m == 7) {
                    var index = (31 - reg_d) + 1 ///23
                    sum = Number(cal_l.length) + Number(reg_d) - 31
                    for (k = 1; k < sum; k++) {
                        if (today.getFullYear() == date.getFullYear() && i == k) {
                            if (cal_l[i + index - 1] == 0) {
                                // cell.bgColor = "#FF00FF"
                                cell.bgColor = "CD5C5C"
                            } else {
                                // cell.bgColor = "0000FF"
                                cell.bgColor = "228B22"
                            }
                        }
                    }
                } else if (reg_m == 8) {
                    sum = Number(reg_d) + Number(cal_l.length)
                    for (k = reg_d; k < sum; k++) {
                        if (today.getFullYear() == date.getFullYear() && i == k) {
                            if (cal_l[i - reg_d] == 0) {
                                cell.bgColor = "CD5C5C"
                            } else {
                                cell.bgColor = "228B22"
                            }
                        }
                    }
                }
            }
        }

        function buildCalendar3() {
            var cal = '{{ cal|tojson }}'
            var cal_l = JSON.parse(cal)
            let reg_y = '{{reg_y}}'
            let reg_m = '{{reg_m}}'
            let reg_d = '{{reg_d}}'
            var doMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            var lastDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            var tbCalendar = document.getElementById("calendar");
            var tbCalendarYM = document.getElementById("tbCalendarYM");
            tbCalendarYM.innerHTML = today.getFullYear() + "년 " + 9 + "월";

            while (tbCalendar.rows.length > 2) {
                tbCalendar.deleteRow(tbCalendar.rows.length - 1);
            }
            var row = null;
            row = tbCalendar.insertRow();
            var cnt = 0;
            for (i = 0; i < doMonth.getDay(); i++) {
                cell = row.insertCell();
                cnt = cnt + 1;
            }
            for (i = 1; i <= 30; i++) {
                cell = row.insertCell();
                cell.innerHTML = i;
                cnt = cnt + 1;
                if (cnt % 7 == 1) {/*일요일 계산*/
                    cell.innerHTML = "<font color=black>" + i
                }
                if (cnt % 7 == 0) {
                    cell.innerHTML = "<font color=black>" + i
                    row = calendar.insertRow();
                }

                if (reg_m == 7) {
                    var index2 = (62 - reg_d) + 1 //25 //56 62-7+1
                    sum = Number(cal_l.length) + Number(reg_d) - 62
                    for (k = 1; k < sum; k++) {
                        if (today.getFullYear() == date.getFullYear() && i == k) {
                            if (cal_l[i + index2 - 1] == 0) {
                                // cell.bgColor = "#FF00FF"
                                cell.bgColor = "CD5C5C"
                            } else {
                                // cell.bgColor = "0000FF"
                                cell.bgColor = "228B22"
                            }
                        }
                    }

                } else if (reg_m == 8) {
                    var index = (31 - reg_d) + 1 ///23
                    sum = Number(cal_l.length) + Number(reg_d) - 31 ///13
                    for (k = 1; k < sum; k++) {
                        if (today.getFullYear() == date.getFullYear() && i == k) {
                            if (cal_l[i + index - 1] == 0) {
                                // cell.bgColor = "#FF00FF"
                                cell.bgColor = "CD5C5C"
                            } else {
                                // cell.bgColor = "0000FF"
                                cell.bgColor = "228B22"
                            }
                        }
                    }
                } else if (reg_m == 9) {
                    sum = Number(reg_d) + Number(cal_l.length)
                    for (k = reg_d; k < sum; k++) {
                        if (today.getFullYear() == date.getFullYear() && i == k) {
                            if (cal_l[i - reg_d] == 0) {
                                cell.bgColor = "CD5C5C"
                            } else {
                                cell.bgColor = "228B22"
                            }
                        }
                    }
                }

            }
        }
    </script>
</head>

<body>
    <h3 align="center" style="font-size: 30px;">{{sid}}</h3>
    <h4 align="center" style="font-size: 30px;">Today Container count : {{cin}}</h4>
    <hr>
    <tr>
        <td><label>
                <img id="jul1" src="../static/jul.png" style="width:80px" onclick="julyCalendar()">
                <img id="jul2" src="../static/july_b.png" style="width:80px" onclick="julyCalendar()">
            </label></td>
        <td><label>
                <img id="aug1" src="../static/aug.png" style="width:80px" onclick="augustCalendar()">
                <img id="aug2" src="../static/aug_b.png" style="width:80px" onclick="augustCalendar()">
            </label></td>
        <td><label>
                <img id="sep1" src="../static/sep.png" style="width:80px" onclick="septemCalendar()">
                <img id="sep2" src="../static/sep_b.png" style="width:80px" onclick="septemCalendar()">
            </label></td>
    </tr>
    <hr>
    <table id="calendar" border="3" align="center" style="border-color:#3333FF ">
        <tr>
            <td align="center" id="tbCalendarYM" colspan="10">
                yyyy년 m월</td>
        </tr>
        <tr>
            <td align="center">
                <font color="#F79DC2">SUN
            </td>
            <td align="center">MON</td>
            <td align="center">TUE</td>
            <td align="center">WED</td>
            <td align="center">TUE</td>
            <td align="center">FRI</td>
            <td align="center">
                <font color="skyblue">SAT
            </td>
        </tr>
    </table>
    Date: <input type="date" id="input_date" name="adate">
    File: <input type="file" id="f" name="filed" multiple="multiple">
    <br>
    <div align="center">
        <button style="width: 15%;" align="center" id="submit" onclick="fileAttach()">
            Attach</button>
    </div>
    <p id="etc" style="text-align: center">
        <img id="jul1" src="../static/red.png" style="width:300px"><br>
        <img id="jul1" src="../static/green.png" style="width:300px"><br>
        1. A dropout is considered when data collection <br>is 70% or less.<br>
        2. If there is a date that could not be collected <br> in the middle, <br>you can collect it on another
        date.<br>
        3. If any data has been collected, please post it.<br>
        <br>
        <==============================><br>
            For inquiries, please contact <br>the 'smartphone/smartwatch activity data collection' open chat room <br>or
            '010-2490-5530'.
    </p>
    <button onclick="toDaily()" id="submit_btn" class="btn btn-primary" style="width: 100%;"
        data-target="#result">Confirm</button>

    <script>
        $(document).ready(function () {
            var today = new Date();
            if ((today.getMonth() + 1) == 7) {
                $("#jul1").show()
                $("#jul2").hide()
                $("#aug1").hide()
                $("#aug2").show()
                $("#sep1").hide()
                $("#sep2").show()
            } else if ((today.getMonth() + 1) == 8) {
                $("#aug1").show()
                $("#aug2").hide()
                $("#jul1").hide()
                $("#jul2").show()
                $("#sep1").hide()
                $("#sep2").show()
            } else if ((today.getMonth() + 1) == 9) {
                $("#sep1").show()
                $("#sep2").hide()
                $("#jul1").hide()
                $("#jul2").show()
                $("#aug1").hide()
                $("#aug2").show()
            }
            $("#jul2").click(function () {
                $("#jul2").hide();
                $("#jul1").show();
                $("#aug1").hide();
                $("#aug2").show();
                $("#sep1").hide();
                $("#sep2").show();
            });
            $("#aug2").click(function () {
                $("#aug2").hide();
                $("#aug1").show();
                $("#jul1").hide();
                $("#jul2").show();
                $("#sep1").hide();
                $("#sep2").show();
            });
            $("#sep2").click(function () {
                $("#sep2").hide();
                $("#sep1").show();
                $("#jul1").hide();
                $("#jul2").show();
                $("#aug1").hide();
                $("#aug2").show();
            });

        })
        // buildCalendar();

        let cal = '{{cal}}'
        let reg_y = '{{reg_y}}'
        let reg_m = '{{reg_m}}'
        let reg_d = '{{reg_d}}'
        cal_l = JSON.parse(cal)

        // var today = new Date();
        // if ((today.getMonth()+1) == 7) {
        //     julyCalendar();
        // } else if ((today.getMonth()+1) == 8) {
        //     augustCalendar();
        // } else if ((today.getMonth()+1) == 9) {
        //     septemCalendar();
        // }

        if ((reg_m == 7)) {
            julyCalendar();
        } else if ((reg_m == 8)) {
            augustCalendar();
        } else if ((reg_m == 9)) {
            septemCalendar();
        }
        let ID = '{{sid}}'
        function toDaily() {
            var postdata = {
                ID
            }
            $.ajax({
                type: 'POST',
                url: '{{url_for("ajax3")}}',
                data: JSON.stringify(postdata),
                dataType: 'JSON',
                contentType: "application/json",
                success: function (response) {
                    $('body').html(response);
                },
                error: function (request, status, error) {
                    alert('ajax 통신 실패')
                    alert(error);
                }
            })
        }

        function fileAttach() {
            var postdata = {
                "dt": document.querySelector("#input_date").value,
                "sid": ID
            }
            var formData = new FormData();
            document.getElementById("submit").innerHTML = "Please wait..";
            formData.append('data', new Blob([JSON.stringify(postdata)], { type: "application/json" }));
            formData.append('filed', document.getElementById("f").files[0]);
            $.ajax({
                type: 'POST',
                url: '{{url_for("justfileen")}}',
                data: formData,
                multiple: true,
                contentType: false,
                processData: false,
                enctype: 'multipart/form-data',
                success: function (response) {
                    document.getElementById("submit").innerHTML = "Attach";
                    $('body').html(response);
                },
                error: function (request, status, error) {
                    alert('ajax 통신 실패')
                    alert(error);
                }
            })
        }

    </script>
</body>

</html>
